# å¾®å‰ç«¯ä½¿ç”¨æŒ‡å—

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
low-code-monorepo/
â”œâ”€â”€ @cwj/                          # æ‰€æœ‰å­åŒ…ç»Ÿä¸€æ”¾åœ¨è¿™é‡Œ
â”‚   â”œâ”€â”€ tools/                     # å·¥å…·å‡½æ•°åº“ (npm åŒ…)
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â””â”€â”€ designer/                  # è®¾è®¡å™¨å­åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”œâ”€â”€ public/
â”‚       â”œâ”€â”€ package.json
â”‚       â”œâ”€â”€ tsconfig.json
â”‚       â””â”€â”€ webpack.config.ts
â”œâ”€â”€ src/                           # ä¸»åº”ç”¨æºç 
â”œâ”€â”€ package.json                   # ä¸»åº”ç”¨é…ç½®
â”œâ”€â”€ vite.config.ts                 # ä¸»åº”ç”¨ Vite é…ç½®
â””â”€â”€ pnpm-workspace.yaml            # Workspace é…ç½®
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 2. å¯åŠ¨åº”ç”¨

#### æ–¹å¼ä¸€: åŒæ—¶å¯åŠ¨ä¸»åº”ç”¨å’Œå­åº”ç”¨ (æ¨è)

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ä¸»åº”ç”¨ (ç«¯å£ 3000)
pnpm dev

# ç»ˆç«¯ 2: å¯åŠ¨ Designer å­åº”ç”¨ (ç«¯å£ 3002)
pnpm dev:designer
```

#### æ–¹å¼äºŒ: åªå¯åŠ¨ä¸»åº”ç”¨

```bash
pnpm dev
```

è®¿é—® http://localhost:3000

### 3. è®¿é—®åº”ç”¨

- **ä¸»åº”ç”¨**: http://localhost:3000
- **Designer å­åº”ç”¨(ç‹¬ç«‹)**: http://localhost:3002

## ğŸ“‹ å¯ç”¨å‘½ä»¤

### ä¸»åº”ç”¨å‘½ä»¤

```bash
# å¼€å‘æ¨¡å¼
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build

# é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬
pnpm preview
```

### å­åº”ç”¨å‘½ä»¤

```bash
# å¯åŠ¨ Designer å­åº”ç”¨
pnpm dev:designer

# æ„å»º Designer å­åº”ç”¨
pnpm build:designer

# é¢„è§ˆ Designer å­åº”ç”¨
pnpm preview:designer
```

### å·¥å…·åŒ…å‘½ä»¤

```bash
# æ„å»º @cwj/tools å·¥å…·åŒ…
pnpm build:tools
```

### å…¨å±€å‘½ä»¤

```bash
# æ„å»ºæ‰€æœ‰åŒ…(ä¸»åº”ç”¨ + æ‰€æœ‰å­åŒ…)
pnpm build:all

# ç±»å‹æ£€æŸ¥
pnpm type-check

# ä»£ç æ£€æŸ¥
pnpm lint

# ä»£ç æ ¼å¼åŒ–
pnpm format
```

## ğŸ¯ Module Federation é…ç½®

### ä¸»åº”ç”¨é…ç½® (vite.config.ts)

ä¸»åº”ç”¨ä½¿ç”¨ Vite + `@originjs/vite-plugin-federation` å®ç°å¾®å‰ç«¯ï¼š

```typescript
import federation from '@originjs/vite-plugin-federation'

export default defineConfig({
  plugins: [
    vue(),
    federation({
      name: 'root',
      remotes: {
        designer: 'http://localhost:3002/assets/remoteEntry.js',
      },
      shared: {
        vue: {
          singleton: true,
          requiredVersion: '^3.5.26',
        },
        'vue-router': {
          singleton: true,
          requiredVersion: '^4.6.4',
        },
      },
    }),
  ],
})
```

### Designer å­åº”ç”¨é…ç½®

å­åº”ç”¨ä»ä½¿ç”¨ Webpack 5 + Module Federationï¼ˆæš‚æœªè¿ç§»ï¼‰ï¼š

```typescript
new ModuleFederationPlugin({
  name: 'designer',
  filename: 'remoteEntry.js',
  exposes: {
    './App': './src/App.vue',
  },
  shared: {
    vue: { singleton: true },
    'vue-router': { singleton: true },
  },
})
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åœ¨ä¸»åº”ç”¨ä¸­åŠ¨æ€åŠ è½½ Designer å­åº”ç”¨

```vue
<script setup lang="ts">
import { defineAsyncComponent } from 'vue'

// åŠ¨æ€å¯¼å…¥ designer å­åº”ç”¨
const DesignerApp = defineAsyncComponent(() => import('designer/App'))
</script>

<template>
  <Suspense>
    <template #default>
      <DesignerApp />
    </template>
    <template #fallback>
      <div>åŠ è½½ä¸­...</div>
    </template>
  </Suspense>
</template>
```

### ä½¿ç”¨ @cwj/tools å·¥å…·åŒ…

```typescript
import { formatDate, debounce, throttle, deepClone } from '@cwj/tools'

// æ ¼å¼åŒ–æ—¥æœŸ
const dateStr = formatDate(new Date(), 'YYYY-MM-DD HH:mm:ss')

// é˜²æŠ–å‡½æ•°
const debouncedFn = debounce(() => {
  console.log('æ‰§è¡Œ')
}, 300)

// èŠ‚æµå‡½æ•°
const throttledFn = throttle(() => {
  console.log('æ‰§è¡Œ')
}, 1000)

// æ·±æ‹·è´
const cloned = deepClone({ a: 1, b: { c: 2 } })
```

## ğŸ”§ æ·»åŠ æ–°çš„å­åº”ç”¨

### 1. åˆ›å»ºå­åº”ç”¨ç›®å½•

```bash
mkdir -p @cwj/your-app/src
```

### 2. åˆ›å»º package.json

```json
{
  "name": "@cwj/your-app",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "vue": "^3.5.26",
    "@cwj/tools": "workspace:*"
  }
}
```

### 3. é…ç½® Module Federation

åœ¨å­åº”ç”¨çš„ `webpack.config.ts` ä¸­:

```typescript
new ModuleFederationPlugin({
  name: 'yourApp',
  filename: 'remoteEntry.js',
  exposes: {
    './App': './src/App.vue',
  },
  shared: {
    vue: { singleton: true },
    'vue-router': { singleton: true },
  },
})
```

### 4. åœ¨ä¸»åº”ç”¨ä¸­æ³¨å†Œ

åœ¨ä¸»åº”ç”¨çš„ `webpack.config.ts` ä¸­æ·»åŠ :

```typescript
remotes: {
  designer: 'designer@http://localhost:3002/remoteEntry.js',
  yourApp: 'yourApp@http://localhost:3003/remoteEntry.js', // æ–°å¢
}
```

### 5. æ›´æ–°ä¸»åº”ç”¨ package.json

```json
{
  "dependencies": {
    "@cwj/your-app": "workspace:*"
  },
  "scripts": {
    "dev:your-app": "pnpm --filter @cwj/your-app dev"
  }
}
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç«¯å£åˆ†é…**
   - ä¸»åº”ç”¨: 3000
   - Designer: 3002
   - å…¶ä»–å­åº”ç”¨: 3003, 3004, ...

2. **ä¾èµ–å…±äº«**
   - vue å’Œ vue-router å¿…é¡»é…ç½®ä¸º singleton
   - ç¡®ä¿ä¸»åº”ç”¨å’Œå­åº”ç”¨ä½¿ç”¨ç›¸åŒç‰ˆæœ¬

3. **å¼€å‘æµç¨‹**
   - å¼€å‘æ—¶éœ€è¦åŒæ—¶å¯åŠ¨ä¸»åº”ç”¨å’Œéœ€è¦çš„å­åº”ç”¨
   - å­åº”ç”¨å¯ä»¥ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•

4. **ç”Ÿäº§éƒ¨ç½²**
   - æ¯ä¸ªåº”ç”¨ç‹¬ç«‹æ„å»ºå’Œéƒ¨ç½²
   - ä¸»åº”ç”¨é€šè¿‡ remoteEntry.js åŠ è½½å­åº”ç”¨

## ğŸ› å¸¸è§é—®é¢˜

### Q: åŠ è½½å­åº”ç”¨å¤±è´¥?

**A**: ç¡®ä¿å­åº”ç”¨å·²å¯åŠ¨:
```bash
pnpm dev:designer
```

### Q: ç±»å‹é”™è¯¯?

**A**: è¿è¡Œç±»å‹æ£€æŸ¥:
```bash
pnpm type-check
```

### Q: ä¾èµ–å®‰è£…å¤±è´¥?

**A**: æ¸…ç†å¹¶é‡æ–°å®‰è£…:
```bash
rm -rf node_modules @cwj/*/node_modules
pnpm install
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¶æ„è®¾è®¡](./æ¶æ„è®¾è®¡.md)
- [å¼€å‘è§„èŒƒ](./å¼€å‘è§„èŒƒ.md)
- [éƒ¨ç½²æ–‡æ¡£](./éƒ¨ç½²æ–‡æ¡£.md)



