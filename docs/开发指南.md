# å¼€å‘æŒ‡å—

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### ç³»ç»Ÿè¦æ±‚

- Node.js >= 16.0.0
- pnpm >= 8.0.0
- Git

### å®‰è£…ä¾èµ–

```bash
# å®‰è£… pnpm (å¦‚æœæœªå®‰è£…)
npm install -g pnpm

# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/low-code-monorepo.git
cd low-code-monorepo

# å®‰è£…ä¾èµ–
pnpm install
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env.local

# ç¼–è¾‘ .env.local
VITE_AUTH_SERVER_URL=https://auth.xxx.com
VITE_CLIENT_ID=your-client-id
VITE_API_BASE_URL=https://api.xxx.com
```

## ğŸš€ æœ¬åœ°å¼€å‘

### ç«¯å£è§„åˆ’

| åº”ç”¨            | ç«¯å£ | è®¿é—®åœ°å€              |
| --------------- | ---- | --------------------- |
| ä¸»åº”ç”¨(Root)    | 3000 | http://localhost:3000 |
| Account(è´¦å·)   | 3001 | http://localhost:3001 |
| Designer        | 3002 | http://localhost:3002 |
| Renderer        | 3003 | http://localhost:3003 |
| Admin           | 3004 | http://localhost:3004 |
| Auth æ–‡æ¡£       | 3005 | http://localhost:3005 |
| UI æ–‡æ¡£(PC)     | 3006 | http://localhost:3006 |
| UI æ–‡æ¡£(Mobile) | 3007 | http://localhost:3007 |
| Tools æ–‡æ¡£      | 3008 | http://localhost:3008 |

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ä¸»åº”ç”¨
pnpm run dev

# å¯åŠ¨å­åº”ç”¨
pnpm --filter account dev
pnpm --filter designer dev
pnpm --filter renderer dev
pnpm --filter admin dev

# åŒæ—¶å¯åŠ¨å¤šä¸ªåº”ç”¨(ä½¿ç”¨ concurrently)
pnpm run dev:all
```

### å¼€å‘æ–°åº”ç”¨

```bash
# 1. åˆ›å»ºæ–°åº”ç”¨ç›®å½•
mkdir -p @cwj/your-app

# 2. åˆå§‹åŒ– package.json
cd @cwj/your-app
pnpm init

# 3. å®‰è£…ä¾èµ–
pnpm add vue vue-router pinia @cwj/auth @cwj/ui-pc @cwj/tools

# 4. åˆ›å»ºåŸºç¡€ç»“æ„
mkdir -p src/{components,views,router,store,api,utils,types,assets}

# 5. åˆ›å»ºå…¥å£æ–‡ä»¶ src/main.ts
# 6. é…ç½® vite.config.ts æˆ– webpack.config.ts
# 7. é…ç½® tsconfig.json
```

### å¼€å‘æ–°çš„ npm åŒ…

```bash
# 1. åˆ›å»ºåŒ…ç›®å½•
mkdir -p @cwj/your-package

# 2. åˆå§‹åŒ–
cd @cwj/your-package
pnpm init

# 3. é…ç½® package.json
{
  "name": "@cwj/your-package",
  "version": "1.0.0",
  "type": "module",
  "main": "./dist/index.cjs",
  "module": "./dist/index.mjs",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "import": "./dist/index.mjs",
      "require": "./dist/index.cjs",
      "types": "./dist/index.d.ts"
    }
  },
  "scripts": {
    "build": "tsup src/index.ts --format esm,cjs --dts",
    "dev": "tsup src/index.ts --format esm,cjs --dts --watch"
  }
}

# 4. å®‰è£…æ„å»ºå·¥å…·
pnpm add -D tsup typescript

# 5. åˆ›å»º src/index.ts
# 6. å¼€å‘å’Œæ„å»º
pnpm run dev    # å¼€å‘æ¨¡å¼
pnpm run build  # æ„å»º
```

## ğŸ”§ å¼€å‘å‘½ä»¤

### å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘
pnpm run dev              # å¯åŠ¨ä¸»åº”ç”¨
pnpm run dev:micro        # å¯åŠ¨å¾®åº”ç”¨
pnpm run dev:all          # å¯åŠ¨æ‰€æœ‰åº”ç”¨

# æ„å»º
pnpm run build            # æ„å»ºä¸»åº”ç”¨
pnpm run build:all        # æ„å»ºæ‰€æœ‰åº”ç”¨
pnpm --filter <app> build # æ„å»ºæŒ‡å®šåº”ç”¨

# ä»£ç è´¨é‡
pnpm run type-check       # TypeScript ç±»å‹æ£€æŸ¥
pnpm run lint             # ESLint ä»£ç æ£€æŸ¥
pnpm run lint:fix         # è‡ªåŠ¨ä¿®å¤ ESLint é—®é¢˜
pnpm run format           # Prettier æ ¼å¼åŒ–ä»£ç 
pnpm run format:check     # æ£€æŸ¥ä»£ç æ ¼å¼
pnpm run check            # å®Œæ•´æ£€æŸ¥(ç±»å‹+lint+æ ¼å¼)

# æµ‹è¯•
pnpm run test             # è¿è¡Œæµ‹è¯•
pnpm run test:watch       # ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
pnpm run test:coverage    # ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

# åŒ…ç®¡ç†
pnpm add <package>        # æ·»åŠ ä¾èµ–åˆ°æ ¹é¡¹ç›®
pnpm --filter <app> add <package>  # æ·»åŠ ä¾èµ–åˆ°æŒ‡å®šåº”ç”¨
pnpm update               # æ›´æ–°æ‰€æœ‰ä¾èµ–
```

### Workspace å‘½ä»¤

```bash
# åœ¨æ‰€æœ‰åŒ…ä¸­æ‰§è¡Œå‘½ä»¤
pnpm -r run build         # é€’å½’æ„å»ºæ‰€æœ‰åŒ…
pnpm -r run test          # é€’å½’æµ‹è¯•æ‰€æœ‰åŒ…

# åœ¨æŒ‡å®šåŒ…ä¸­æ‰§è¡Œå‘½ä»¤
pnpm --filter designer dev
pnpm --filter @cwj/auth build

# æŸ¥çœ‹ä¾èµ–å…³ç³»
pnpm list                 # æŸ¥çœ‹æ‰€æœ‰ä¾èµ–
pnpm why <package>        # æŸ¥çœ‹ä¸ºä»€ä¹ˆå®‰è£…äº†æŸä¸ªåŒ…
```

## ğŸ› è°ƒè¯•

### VSCode è°ƒè¯•é…ç½®

åˆ›å»º `.vscode/launch.json`:

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "chrome",
      "request": "launch",
      "name": "è°ƒè¯•ä¸»åº”ç”¨",
      "url": "http://localhost:3000",
      "webRoot": "${workspaceFolder}/src",
      "sourceMapPathOverrides": {
        "webpack:///./*": "${webRoot}/*"
      }
    },
    {
      "type": "chrome",
      "request": "launch",
      "name": "è°ƒè¯•è®¾è®¡å™¨",
      "url": "http://localhost:3002",
      "webRoot": "${workspaceFolder}/@cwj/designer/src"
    }
  ]
}
```

### æµè§ˆå™¨è°ƒè¯•

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. åœ¨ Sources é¢æ¿ä¸­æ‰¾åˆ°æºä»£ç 
3. è®¾ç½®æ–­ç‚¹
4. åˆ·æ–°é¡µé¢è§¦å‘æ–­ç‚¹

### Vue Devtools

å®‰è£… Vue Devtools æµè§ˆå™¨æ‰©å±•:

- Chrome: https://chrome.google.com/webstore
- Firefox: https://addons.mozilla.org/

## ğŸ“ ä»£ç æç¤º

### VSCode æ’ä»¶æ¨è

åœ¨ `.vscode/extensions.json` ä¸­é…ç½®:

```json
{
  "recommendations": [
    "vue.volar",
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "lokalise.i18n-ally",
    "antfu.iconify"
  ]
}
```

### TypeScript ç±»å‹æç¤º

```typescript
// åœ¨ src/shims-vue.d.ts ä¸­å£°æ˜æ¨¡å—ç±»å‹
declare module '*.vue' {
  import type { DefineComponent } from 'vue'
  const component: DefineComponent<{}, {}, any>
  export default component
}

// ä½¿ç”¨ç±»å‹å¯¼å…¥
import type { Ref } from 'vue'
import type { RouteLocationNormalized } from 'vue-router'
```

## ğŸ” å¸¸è§é—®é¢˜

### 1. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3000

# æ€æ­»è¿›ç¨‹
kill -9 <PID>

# æˆ–è€…ä¿®æ”¹ç«¯å£
# åœ¨ vite.config.ts ä¸­ä¿®æ”¹ server.port
```

### 2. ä¾èµ–å®‰è£…å¤±è´¥

```bash
# æ¸…ç†ç¼“å­˜
pnpm store prune

# åˆ é™¤ node_modules å’Œ lock æ–‡ä»¶
rm -rf node_modules pnpm-lock.yaml

# é‡æ–°å®‰è£…
pnpm install
```

### 3. ç±»å‹æ£€æŸ¥é”™è¯¯

```bash
# æ¸…ç† TypeScript ç¼“å­˜
rm -rf node_modules/.cache

# é‡æ–°ç”Ÿæˆç±»å‹
pnpm run type-check
```

### 4. çƒ­æ›´æ–°ä¸ç”Ÿæ•ˆ

```bash
# ä¸»åº”ç”¨ä½¿ç”¨ Viteï¼Œæ£€æŸ¥ vite.config.ts ä¸­çš„ HMR é…ç½®
server: {
  hmr: true
}

# æ£€æŸ¥æ–‡ä»¶ç›‘å¬æ•°é‡é™åˆ¶(Linux/Mac)
echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
sudo sysctl -p
```

### 5. Module Federation åŠ è½½å¤±è´¥

```bash
# æ£€æŸ¥ remoteEntry.js æ˜¯å¦å¯è®¿é—®
curl http://localhost:3002/assets/remoteEntry.js

# ä¸»åº”ç”¨ä½¿ç”¨ Viteï¼Œæ£€æŸ¥ vite.config.ts ä¸­çš„ Module Federation é…ç½®
# ç¡®ä¿ name å’Œ remotes é…ç½®æ­£ç¡®
# å­åº”ç”¨ä½¿ç”¨ Webpackï¼Œæ£€æŸ¥ webpack.config.ts é…ç½®
```

### 6. Cookie ä¸å…±äº«

```bash
# æ£€æŸ¥ Cookie é…ç½®
# domain å¿…é¡»è®¾ç½®ä¸º .xxx.com
# ç¡®ä¿æ‰€æœ‰åº”ç”¨ä½¿ç”¨ç›¸åŒçš„åŸŸå

# æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
# Application -> Cookies -> æŸ¥çœ‹ Cookie é…ç½®
```

## ğŸ¯ å¼€å‘æŠ€å·§

### 1. ä½¿ç”¨ä»£ç ç‰‡æ®µ

åœ¨ `.vscode/snippets.code-snippets` ä¸­åˆ›å»ºä»£ç ç‰‡æ®µ:

```json
{
  "Vue Component": {
    "prefix": "vcomp",
    "body": [
      "<template>",
      "  <div class=\"${1:component-name}\">",
      "    ${2}",
      "  </div>",
      "</template>",
      "",
      "<script setup lang=\"ts\">",
      "${3}",
      "</script>",
      "",
      "<style scoped>",
      ".${1:component-name} {",
      "  ${4}",
      "}",
      "</style>"
    ]
  }
}
```

### 2. ä½¿ç”¨ Git Hooks

```bash
# å®‰è£… husky
pnpm add -D husky

# åˆå§‹åŒ–
npx husky install

# æ·»åŠ  pre-commit hook
npx husky add .husky/pre-commit "pnpm run lint"
npx husky add .husky/pre-commit "pnpm run type-check"
```

### 3. ä½¿ç”¨ Mock æ•°æ®

```typescript
// src/mock/index.ts
import { setupWorker } from 'msw'
import { handlers } from './handlers'

export const worker = setupWorker(...handlers)

// åœ¨å¼€å‘ç¯å¢ƒå¯åŠ¨
if (import.meta.env.DEV) {
  worker.start()
}
```

### 4. æ€§èƒ½åˆ†æ

```bash
# ä¸»åº”ç”¨ä½¿ç”¨ Viteï¼Œä½¿ç”¨ rollup-plugin-visualizer
pnpm add -D rollup-plugin-visualizer

# åœ¨ vite.config.ts ä¸­æ·»åŠ 
import { visualizer } from 'rollup-plugin-visualizer'

plugins: [
  visualizer({ open: true })
]

# æ„å»ºå¹¶åˆ†æ
pnpm run build
```

## ğŸ“š ç›¸å…³èµ„æº

- [Vue 3 æ–‡æ¡£](https://cn.vuejs.org/)
- [TypeScript æ–‡æ¡£](https://www.typescriptlang.org/)
- [Vite æ–‡æ¡£](https://cn.vitejs.dev/)
- [vite-plugin-federation æ–‡æ¡£](https://github.com/originjs/vite-plugin-federation)
- [Webpack æ–‡æ¡£](https://webpack.js.org/)
- [Module Federation æ–‡æ¡£](https://webpack.js.org/concepts/module-federation/)
- [Pinia æ–‡æ¡£](https://pinia.vuejs.org/)
- [Element Plus æ–‡æ¡£](https://element-plus.org/)
